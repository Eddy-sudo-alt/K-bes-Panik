<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>K√∂bes Panik</title>
<style>
  html,body{height:100%;margin:0;background:#000;overflow:hidden;-webkit-tap-highlight-color:transparent}
  .stage{position:fixed;inset:0;}
  #bg{position:absolute;inset:0;width:100vw;height:100vh;object-fit:cover;object-position:center;user-select:none;pointer-events:none}

  /* Geldanzeige */
  .money{
    position:absolute; top:12px; left:12px; z-index:4;
    background:rgba(0,0,0,.45); color:#ffd700;
    border:1px solid rgba(255,215,0,0.4); border-radius:10px;
    padding:6px 10px; font:600 16px/1.2 system-ui;
    backdrop-filter: blur(2px); box-shadow:0 2px 6px rgba(0,0,0,0.4);
  }

  /* Energie-Balken */
  .energybar{
    position:absolute; top:46px; left:12px; z-index:4;
    width:140px; height:16px; border:1px solid rgba(255,255,255,0.4);
    background:rgba(0,0,0,0.5); border-radius:8px; overflow:hidden;
  }
  .energyfill{
    height:100%; width:100%; background:linear-gradient(90deg,#4caf50,#ffeb3b,#f44336);
    transition:width .25s ease;
  }

  /* Buttons rechts oben */
  .topbtn{
    position:absolute; top:12px; z-index:4;
    width:42px; height:42px; display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.45); color:#ffd700;
    border:1px solid rgba(255,215,0,.4); border-radius:10px;
    font:22px/1 "Apple Color Emoji","Segoe UI Emoji",system-ui;
    cursor:pointer; user-select:none; box-shadow:0 2px 6px rgba(0,0,0,.4);
  }
  #eatBtn{ right:156px; }
  #drinkBtn{ right:108px; }
  #smokeBtn{ right:60px; }
  #assistantToggle{ right:12px; }
  #assistantToggle.active{ background:rgba(0,128,0,.4); border-color:rgba(120,255,120,.5); }

  /* Effekte */
  .fx{
    position:absolute; z-index:5; font:700 18px/1 system-ui;
    text-shadow:0 1px 2px rgba(0,0,0,.5); pointer-events:none; opacity:0;
    transform: translate(-50%,0); animation: rise 900ms ease-out forwards;
    white-space:nowrap;
  }
  .fx.money{ color:#ffd700; font-size:16px; }
  .fx.tip  { color:#56e39f; font-size:16px; }
  .fx.emoji{ font-size:26px; }
  .fx.malus{ color:#ef5350; font-size:16px; }
  @keyframes rise{
    0%{opacity:0;transform:translate(-50%,10px)}
    12%{opacity:1;transform:translate(-50%,0)}
    70%{opacity:1;transform:translate(-50%,-40px)}
    100%{opacity:0;transform:translate(-50%,-60px)}
  }

  /* Level-Up Banner */
  .levelup{
    position:absolute; top:14px; left:50%; transform:translateX(-50%);
    z-index:6; background:rgba(0,0,0,.55); color:#ffd700;
    border:1px solid rgba(255,215,0,.45); border-radius:12px;
    padding:10px 18px; font:700 16px/1 system-ui;
    box-shadow:0 2px 10px rgba(0,0,0,.5); display:none; animation: pop 900ms ease-out;
  }
  @keyframes pop{
    0%{transform:translateX(-50%) scale(.8);opacity:0}
    25%{transform:translateX(-50%) scale(1.05);opacity:1}
    100%{transform:translateX(-50%) scale(1);opacity:1}
  }

  /* Gl√§ser */
  .glass{
    position:absolute;width:46px;height:70px;border:2px solid #d4aa00;border-radius:6px;
    background:rgba(255,255,255,.04);overflow:hidden;box-shadow:0 0 6px rgba(0,0,0,.55);
    z-index:3;cursor:pointer; transition:border-color .2s ease;
  }
  .glass.low{border-color:#ffb300}
  .glass.empty{border-color:#ef5350}
  .fill{position:absolute;left:0;bottom:0;width:100%;height:100%;
    background:linear-gradient(180deg,#f7e17c,#e1b12c);transition:height .22s ease}

  /* Popup */
  .popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:7}
  .popup-content{background:#1b1f2a;color:#fff;padding:20px 24px;border-radius:10px;text-align:center;max-width:80%;
    font-family:system-ui;box-shadow:0 4px 20px rgba(0,0,0,.6)}
  .popup-content button{margin-top:12px;padding:8px 14px;border:none;border-radius:6px;background:#f6c356;color:#141821;font-weight:bold;cursor:pointer}

  /* Game Over */
  .gameover{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000;color:#e8ecf1;z-index:8;
    font:700 20px/1.3 system-ui;text-align:center;padding:24px}
</style>
</head>
<body>
  <div class="stage" id="stage">
    <img id="bg" src="bg.PNG" alt="" />

    <div class="money" id="money">0,00 ‚Ç¨</div>
    <div class="energybar"><div class="energyfill" id="energyFill"></div></div>

    <!-- Buttons -->
    <div class="topbtn" id="eatBtn" title="Essen (2,00‚Ç¨)">üçñ</div>
    <div class="topbtn" id="drinkBtn" title="Bier (1,50‚Ç¨)">üç∫</div>
    <div class="topbtn" id="smokeBtn" title="Zigarette (1,00‚Ç¨)">üö¨</div>
    <div class="topbtn" id="assistantToggle" title="Assistent an/aus">ü§ù</div>

    <div class="levelup" id="levelup">Level Up ‚Äì Neues Glas!</div>
  </div>

  <audio id="bgm" src="Tavern.mp3" loop></audio>

  <div class="popup" id="popup">
    <div class="popup-content">
      <div id="popupText">Erste Abmahnung</div>
      <button id="popupBtn">OK</button>
    </div>
  </div>

  <div class="gameover" id="gameover">
    Game Over<br/>Du musst zum Arbeitsamt.
  </div>

<script>
/* Einstellungen */
const BASE_EURO = 0.25;
const TIP_RATE = 0.10;
const UNLOCK_STEP = 3;
const RAND_BOX = { xMin: 22, xMax: 88, yMin: 55, yMax: 82 };
const FOOD_COST = 2.00, BEER_COST = 1.50, SMOKE_COST = 1.00;
const FOOD_ENERGY = 40, BEER_ENERGY = 25, SMOKE_ENERGY = 15;

let money = 0, strikes = 0, ended = false;
let assistantOn = false;
let progressGoodFills = 0;
let energy = 100;

/* DOM */
const stage = document.getElementById('stage');
const moneyEl = document.getElementById('money');
const energyFill = document.getElementById('energyFill');
const levelEl = document.getElementById('levelup');
const popup = document.getElementById('popup');
const popupText = document.getElementById('popupText');
const popupBtn = document.getElementById('popupBtn');
const gameover = document.getElementById('gameover');
const bgm = document.getElementById('bgm');

/* Sounds */
const sFill = new Audio('fill.mp3'); sFill.volume = 0.6;
bgm.volume = 0.5; bgm.play().catch(()=>{});
document.addEventListener('pointerdown',()=>{if(bgm.paused)bgm.play()}, {once:true});

/* Geld */
function euro(v){ return v.toFixed(2).replace('.', ',')+' ‚Ç¨'; }
function updateMoney(){ moneyEl.textContent = euro(money); }

/* Energie */
function updateEnergy(){
  energy = Math.min(100, Math.max(0, energy));
  energyFill.style.width = energy + '%';
  if(energy <= 0 && !ended) endGame('Krankenhaus ‚Äì Du bist gefeuert!');
}

/* Glas-Logik */
const glasses = [];
function rand(min,max){ return min + Math.random()*(max-min); }
function randi(min,max){ return Math.floor(rand(min,max+1)); }

function addGlass(){
  const el = document.createElement('div');
  el.className = 'glass';
  const fill = document.createElement('div');
  fill.className = 'fill';
  el.appendChild(fill);
  stage.appendChild(el);
  const g = { el, fillEl: fill, pct:100, speed:rand(4,6), jitter:0, warnedThisCycle:false };
  el.style.left = randi(RAND_BOX.xMin, RAND_BOX.xMax) + '%';
  el.style.top = randi(RAND_BOX.yMin, RAND_BOX.yMax) + '%';
  el.addEventListener('click', ()=>handleFill(g));
  glasses.push(g);
}

function handleFill(g){
  if(ended) return;
  sFill.currentTime = 0; sFill.play();
  const prev = g.pct; g.pct = 100; g.warnedThisCycle = false;
  let addBase = BASE_EURO, tipAdd = 0, emoji='', malus='';
  if(prev <= 33){ emoji='üòÄ'; tipAdd = BASE_EURO*TIP_RATE; progressGoodFills++; }
  else if(prev <= 66){ emoji='üòê'; }
  else{ emoji='üò†'; if(progressGoodFills>0) progressGoodFills--; }
  let share = assistantOn ? 0.5 : 1;
  money += (addBase+tipAdd)*share; updateMoney();
  checkUnlock();
}

function checkUnlock(){
  if(progressGoodFills % UNLOCK_STEP === 0) addGlass();
}

function loop(){
  if(ended) return;
  glasses.forEach(g=>{
    g.pct = Math.max(0, g.pct - g.speed*0.02);
    g.fillEl.style.height = g.pct + '%';
    if(g.pct <= 0 && !g.warnedThisCycle){
      g.warnedThisCycle = true; strikes++;
      if(strikes===1) popupText.textContent='Erste Abmahnung';
      else if(strikes===2) popupText.textContent='Zweite Abmahnung';
      else if(strikes>=3) endGame('K√ºndigung');
      popup.style.display='flex';
    }
  });
  energy -= 0.01; updateEnergy();
  requestAnimationFrame(loop);
}

/* End */
function endGame(msg){
  ended = true;
  popup.style.display='none';
  gameover.innerHTML = 'Game Over<br>'+msg;
  gameover.style.display='flex';
}

/* Buttons */
document.getElementById('assistantToggle').onclick = ()=>assistantOn=!assistantOn;
document.getElementById('eatBtn').onclick = ()=>{ if(money>=FOOD_COST){ money-=FOOD_COST; energy+=FOOD_ENERGY; updateMoney(); updateEnergy(); } };
document.getElementById('drinkBtn').onclick = ()=>{ if(money>=BEER_COST){ money-=BEER_COST; energy+=BEER_ENERGY; updateMoney(); updateEnergy(); } };
document.getElementById('smokeBtn').onclick = ()=>{ if(money>=SMOKE_COST){ money-=SMOKE_COST; energy+=SMOKE_ENERGY; updateMoney(); updateEnergy(); } };
popupBtn.onclick = ()=>popup.style.display='none';

/* Start */
updateMoney(); updateEnergy();
addGlass();
requestAnimationFrame(loop);
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title></title>
  <style>
    html,body{height:100%;margin:0;background:#000;overflow:hidden;-webkit-tap-highlight-color:transparent}
    .stage{position:fixed;inset:0;padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0)}
    #bg{position:absolute;inset:0;width:100vw;height:100vh;object-fit:cover;object-position:center;user-select:none;pointer-events:none}

    /* Glas */
    .glass{
      position:absolute;width:46px;height:70px;border:2px solid #d4aa00;border-radius:6px;
      background:rgba(255,255,255,.04);overflow:hidden;box-shadow:0 0 6px rgba(0,0,0,.55);
      z-index:2;touch-action:manipulation;cursor:pointer
    }
    .glass.low{border-color:#ffb300}
    .glass.empty{border-color:#ef5350}
    .fill{position:absolute;left:0;bottom:0;width:100%;height:100%;background:linear-gradient(180deg,#f7e17c,#e1b12c);transition:height .22s ease}

    /* Abmahnungs-Popup */
    .popup{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.5); z-index:5;
    }
    .popup-content{
      background:#1b1f2a; color:#fff; padding:20px 24px; border-radius:10px; text-align:center;
      max-width:80%; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow:0 4px 20px rgba(0,0,0,0.6);
    }
    .popup-content button{
      margin-top:12px; padding:8px 14px; border:none; border-radius:6px;
      background:#f6c356; color:#141821; font-weight:bold; cursor:pointer;
    }

    /* Game Over */
    .gameover{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:#000; color:#e8ecf1; z-index:6;
      font:700 20px/1.3 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      text-align:center; padding:24px;
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <img id="bg" alt=""
         src="https://raw.githubusercontent.com/Eddy-sudo-alt/K-bes-Panik/refs/heads/main/D865D92A-F21B-4602-A575-BC42B2B79A98.png"/>

    <!-- Ein Glas -->
    <div class="glass" id="g1"><div class="fill"></div></div>
  </div>

  <!-- Abmahnungs-Popup -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <div id="popupText">Erste Abmahnung</div>
      <button id="popupBtn">OK</button>
    </div>
  </div>

  <!-- Schwarzer Endscreen -->
  <div class="gameover" id="gameover">
    Game Over<br/>du musst zum Arbeitsamt.
  </div>

  <script>
    // Position des Glases (dein Punkt, leicht nach oben gesetzt)
    const point = { x: 53, y: 69 };

    // Glas-Status
    const g = {
      el: document.getElementById('g1'),
      fillEl: document.querySelector('#g1 .fill'),
      pct: 100,
      speed: 4.2,    // % pro Sekunde – nur Entleerung
      jitter: 0,
      warnedThisCycle: false
    };

    let strikes = 0;      // 0,1,2 -> bei 3 = Kündigung
    let ended   = false;  // Game Over?

    const popup     = document.getElementById('popup');
    const popupText = document.getElementById('popupText');
    const popupBtn  = document.getElementById('popupBtn');
    const gameover  = document.getElementById('gameover');

    function showPopup(text){
      popupText.textContent = text;
      popup.style.display = 'flex';
    }
    function hidePopup(){
      popup.style.display = 'none';
    }
    popupBtn.addEventListener('click', ()=>{
      // Wenn gerade Kündigung angezeigt wurde -> jetzt Game Over zeigen
      if (strikes >= 3){
        hidePopup();
        gameover.style.display = 'flex';
        ended = true;
      } else {
        hidePopup();
      }
    });

    // Tippen/Klicken => füllt und startet neuen Zyklus
    const fillUp = ()=>{
      if (ended) return;
      g.pct = 100;
      g.warnedThisCycle = false;
      render();
    };
    g.el.addEventListener('click', fillUp);
    g.el.addEventListener('touchend', fillUp, {passive:true});

    // Entleerungs-Loop
    let last = performance.now();
    function loop(now){
      if (ended) return;
      const dt = Math.min(1000, now - last) / 1000; last = now;

      const eff = Math.max(0, g.speed + g.jitter);
      g.pct = Math.max(0, g.pct - eff * dt);

      // Abmahnungen/Kündigung bei Leerstand (einmal pro Zyklus)
      if (g.pct <= 0 && !g.warnedThisCycle){
        g.warnedThisCycle = true;
        strikes++;
        if (strikes === 1)      showPopup('Erste Abmahnung');
        else if (strikes === 2) showPopup('Zweite Abmahnung');
        else if (strikes >= 3)  showPopup('Kündigung');
      }

      render();
      requestAnimationFrame(loop);
    }

    function render(){
      g.fillEl.style.height = g.pct + '%';
      g.el.classList.toggle('low',   g.pct <= 35 && g.pct > 0);
      g.el.classList.toggle('empty', g.pct <=  0);
    }

    // kleine zufällige Schwankungen (wirkt natürlicher)
    function reshuffleJitter(){
      if (ended) return;
      g.jitter = (Math.random()*0.4 - 0.2) * g.speed; // ±20 %
      setTimeout(reshuffleJitter, 7000 + Math.random()*5000);
    }
    reshuffleJitter();

    // Exakte Position über dem cover-Bild
    const stage = document.getElementById('stage');
    const bg    = document.getElementById('bg');
    function positionGlass(){
      const sw = stage.clientWidth, sh = stage.clientHeight;
      const iw = bg.naturalWidth || 1024, ih = bg.naturalHeight || 1024;
      const scale = Math.max(sw/iw, sh/ih);
      const dw = iw*scale, dh = ih*scale;
      const offX = (sw - dw)/2, offY = (sh - dh)/2;
      const w = g.el.offsetWidth, h = g.el.offsetHeight;
      const x = offX + (point.x/100)*dw;
      const y = offY + (point.y/100)*dh;
      g.el.style.left = (x - w/2) + 'px';
      g.el.style.top  = (y - h*0.65) + 'px';
    }
    if (bg.complete) positionGlass(); else bg.addEventListener('load', positionGlass);
    addEventListener('resize', positionGlass, {passive:true});
    addEventListener('orientationchange', positionGlass, {passive:true});

    // Start
    requestAnimationFrame(loop);
  </script>
</body>
</html>
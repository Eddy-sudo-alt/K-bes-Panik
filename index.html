<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>K√∂bes Panik</title>
<style>
html,body{height:100%;margin:0;background:#000;overflow:hidden;-webkit-tap-highlight-color:transparent}
.stage{position:fixed;inset:0}
#bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none}

.money{
  position:absolute; top:6px; left:8px; z-index:10;
  background:rgba(0,0,0,0.4); color:#ffd700; padding:4px 8px;
  border-radius:6px; font:600 15px system-ui,sans-serif;
}
.energy-bar{
  position:absolute; top:32px; left:8px; width:120px; height:14px;
  border:1px solid #000; background:red; z-index:10;
}
.energy-fill{
  height:100%; width:100%; background:green;
}

.top-buttons{
  position:absolute; top:8px; right:8px; display:flex; gap:6px; z-index:10;
}
.btn{
  width:40px; height:40px; background:rgba(0,0,0,0.4); border-radius:6px;
  display:flex; align-items:center; justify-content:center; font-size:22px;
  cursor:pointer; user-select:none;
}
.btn:active{transform:scale(0.9)}

.glass{
  position:absolute; width:46px; height:70px; border:2px solid #d4aa00; border-radius:6px;
  background:rgba(255,255,255,0.05); overflow:hidden; cursor:pointer;
}
.fill{
  position:absolute; bottom:0; left:0; width:100%;
  background:linear-gradient(180deg,#f7e17c,#e1b12c);
}

.fx{
  position:absolute; pointer-events:none; font:700 16px system-ui;
  text-shadow:0 1px 2px rgba(0,0,0,0.5);
  animation: rise 1s ease-out forwards;
}
@keyframes rise{
  0%{opacity:0; transform:translateY(0)}
  20%{opacity:1}
  100%{opacity:0; transform:translateY(-40px)}
}
.fx.money{color:#ffd700}
.fx.tip{color:#56e39f}
.fx.emoji{font-size:24px}
.fx.malus{color:#ef5350}

.popup{
  position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:20;
}
.popup-content{
  background:#222; color:#fff; padding:20px; border-radius:8px; text-align:center;
}
.popup-content button{
  margin-top:12px; padding:6px 10px; font-weight:bold;
}

.gameover{
  position:fixed; inset:0; background:#000; color:#fff; display:none;
  align-items:center; justify-content:center; font-size:20px; z-index:30; text-align:center;
}
</style>
</head>
<body>
<div class="stage" id="stage">
  <img id="bg" src="bg.PNG" alt=""/>
  <div class="money" id="money">0,00 ‚Ç¨</div>
  <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
  <div class="top-buttons">
    <div class="btn" id="eatBtn">üçó</div>
    <div class="btn" id="smokeBtn">üö¨</div>
    <div class="btn" id="drinkBtn">üç∫</div>
    <div class="btn" id="assistantBtn">ü§ù</div>
    <div class="btn" id="soundBtn">üîä</div>
  </div>
</div>

<audio id="bgm" src="Tavern.mp3" loop></audio>
<audio id="fillSound" src="fill.mp3"></audio>

<div class="popup" id="popup">
  <div class="popup-content">
    <div id="popupText"></div>
    <button id="popupOk">OK</button>
  </div>
</div>

<div class="gameover" id="gameover">
  Game Over<br/>Du wurdest gek√ºndigt.<br/>Du musst zum Arbeitsamt.
</div>

<script>
const moneyEl = document.getElementById('money');
const energyFill = document.getElementById('energyFill');
const stage = document.getElementById('stage');
const popup = document.getElementById('popup');
const popupText = document.getElementById('popupText');
const popupOk = document.getElementById('popupOk');
const gameover = document.getElementById('gameover');
const bgm = document.getElementById('bgm');
const fillSound = document.getElementById('fillSound');

let money = 0;
let energy = 100;
let strikes = 0;
let ended = false;
let assistantOn = false;
let goodFills = 0;
let glasses = [];

const BASE_EURO = 0.25;
const TIP_MID = 0.05;
const TIP_LOW = 0.10;
const RAND_AREA = {xMin:25, xMax:75, yMin:55, yMax:82}; // % Bereich im roten Feld

function updateMoney(){ moneyEl.textContent = money.toFixed(2).replace('.', ',') + ' ‚Ç¨'; }
function updateEnergy(){
  energyFill.style.width = energy + '%';
  energyFill.style.background = `hsl(${energy*1.2}, 80%, 40%)`; // Gr√ºn‚ÜíRot
}

function addGlass(){
  const g = document.createElement('div');
  g.className = 'glass';
  g.style.left = rand(RAND_AREA.xMin, RAND_AREA.xMax) + '%';
  g.style.top = rand(RAND_AREA.yMin, RAND_AREA.yMax) + '%';
  const f = document.createElement('div');
  f.className = 'fill';
  f.style.height = '100%';
  g.appendChild(f);
  stage.appendChild(g);
  const glassObj = {el:g, fill:f, pct:100, speed:rand(5,8), warned:false};
  g.addEventListener('click', ()=>fillGlass(glassObj));
  glasses.push(glassObj);
}
function rand(min,max){ return min + Math.random()*(max-min); }

function spawnFx(text, cls, x, y){
  const d = document.createElement('div');
  d.className = 'fx ' + cls;
  d.textContent = text;
  d.style.left = x + 'px';
  d.style.top = y + 'px';
  document.body.appendChild(d);
  setTimeout(()=>d.remove(), 1000);
}

function fillGlass(g){
  if(ended) return;
  fillSound.currentTime=0; fillSound.play();
  let prev = g.pct;
  g.pct = 100; g.warned = false;
  let emoji = '', tip = 0, malus=null;

  if(prev > 66){
    emoji = 'üò†';
    if(goodFills>0){goodFills--; malus='-1 Fortschritt';}
  } else if(prev > 33){
    emoji = 'üòê'; tip = BASE_EURO * TIP_MID;
  } else {
    emoji = 'üòÄ'; tip = BASE_EURO * TIP_LOW; goodFills++;
  }
  let earn = BASE_EURO + tip;
  if(assistantOn) earn *= 0.5;
  money += earn; updateMoney();

  const r = g.el.getBoundingClientRect();
  spawnFx('+'+earn.toFixed(2).replace('.',','), 'money', r.left, r.top-20);
  if(tip>0) spawnFx('TIP', 'tip', r.left+30, r.top-20);
  spawnFx(emoji, 'emoji', r.left+15, r.top-40);
  if(malus) spawnFx(malus, 'malus', r.left+15, r.top);

  if(goodFills % 3 === 0) addGlass();
}

function loop(){
  if(ended) return;
  glasses.forEach(g=>{
    g.pct -= g.speed*0.02;
    if(g.pct < 0) g.pct = 0;
    g.fill.style.height = g.pct + '%';
    if(g.pct <= 0 && !g.warned){
      g.warned = true;
      strikes++;
      if(strikes>=3){ showPopup('K√ºndigung'); }
      else showPopup(strikes===1?'Erste Abmahnung':'Zweite Abmahnung');
    }
  });
  energy -= 0.01;
  if(energy<=0){ showPopup('Kollaps ‚Äì Krankenhaus!'); }
  updateEnergy();
  requestAnimationFrame(loop);
}

function showPopup(msg){
  popupText.textContent = msg;
  popup.style.display='flex';
}

popupOk.onclick = ()=>{
  popup.style.display='none';
  if(strikes>=3 || energy<=0){
    ended=true; gameover.style.display='flex';
  }
};

document.getElementById('eatBtn').onclick = ()=>{
  if(money>=1){money-=1; energy=Math.min(100,energy+20); updateMoney(); updateEnergy();}
};
document.getElementById('smokeBtn').onclick = ()=>{
  if(money>=0.5){money-=0.5; energy=Math.min(100,energy+5); updateMoney(); updateEnergy();}
};
document.getElementById('drinkBtn').onclick = ()=>{
  if(money>=0.7){money-=0.7; energy=Math.min(100,energy+10); updateMoney(); updateEnergy();}
};
document.getElementById('assistantBtn').onclick = ()=>{
  assistantOn = !assistantOn;
  document.getElementById('assistantBtn').style.background = assistantOn?'rgba(0,128,0,0.4)':'rgba(0,0,0,0.4)';
};
document.getElementById('soundBtn').onclick = ()=>{
  bgm.muted=!bgm.muted;
  document.getElementById('soundBtn').textContent = bgm.muted?'üîá':'üîä';
};

bgm.play().catch(()=>{document.addEventListener('click',()=>bgm.play(),{once:true});});

// Start
updateMoney();
updateEnergy();
addGlass();
loop();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title></title>
  <style>
    html,body{height:100%;margin:0;background:#000;overflow:hidden;-webkit-tap-highlight-color:transparent}
    .stage{position:fixed;inset:0;padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0)}
    #bg{position:absolute;inset:0;width:100vw;height:100vh;object-fit:cover;object-position:center;user-select:none;pointer-events:none}

    /* Geldanzeige */
    .money{
      position:absolute; top:12px; left:12px; z-index:3;
      background:rgba(0,0,0,.45);
      color:#ffd700;
      border:1px solid rgba(255,215,0,0.4);
      border-radius:10px;
      padding:8px 14px;
      font:600 16px/1.2 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      backdrop-filter: blur(2px);
      box-shadow:0 2px 6px rgba(0,0,0,0.4);
    }

    /* Effekte (+0,20€ und Emoji) */
    .fx{
      position:absolute; z-index:4;
      font:700 20px/1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      text-shadow:0 1px 2px rgba(0,0,0,.5);
      pointer-events:none;
      opacity:0;
      transform: translate(-50%, 0) translateZ(0);
      animation: rise 900ms ease-out forwards;
    }
    .fx.moneyFx{ color:#ffd700; font-size:16px; }
    .fx.emojiFx{ font-size:26px; }
    @keyframes rise{
      0%   { opacity:0; transform: translate(-50%, 10px); }
      12%  { opacity:1; transform: translate(-50%, 0); }
      70%  { opacity:1; transform: translate(-50%, -40px); }
      100% { opacity:0; transform: translate(-50%, -60px); }
    }

    /* Glas */
    .glass{
      position:absolute;width:46px;height:70px;border:2px solid #d4aa00;border-radius:6px;
      background:rgba(255,255,255,.04);overflow:hidden;box-shadow:0 0 6px rgba(0,0,0,.55);
      z-index:2;touch-action:manipulation;cursor:pointer
    }
    .glass.low{border-color:#ffb300}
    .glass.empty{border-color:#ef5350}
    .fill{position:absolute;left:0;bottom:0;width:100%;height:100%;background:linear-gradient(180deg,#f7e17c,#e1b12c);transition:height .22s ease}

    /* Popups */
    .popup{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.5); z-index:5;
    }
    .popup-content{
      background:#1b1f2a; color:#fff; padding:20px 24px; border-radius:10px; text-align:center;
      max-width:80%; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow:0 4px 20px rgba(0,0,0,0.6);
    }
    .popup-content button{
      margin-top:12px; padding:8px 14px; border:none; border-radius:6px;
      background:#f6c356; color:#141821; font-weight:bold; cursor:pointer;
    }

    /* Game Over */
    .gameover{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:#000; color:#e8ecf1; z-index:6;
      font:700 20px/1.3 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      text-align:center; padding:24px;
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <img id="bg" alt=""
         src="https://raw.githubusercontent.com/Eddy-sudo-alt/K-bes-Panik/refs/heads/main/D865D92A-F21B-4602-A575-BC42B2B79A98.png"/>

    <!-- Geldanzeige -->
    <div class="money" id="money">0,00 €</div>

    <!-- Glas -->
    <div class="glass" id="g1"><div class="fill"></div></div>
  </div>

  <!-- Popup -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <div id="popupText">Erste Abmahnung</div>
      <button id="popupBtn">OK</button>
    </div>
  </div>

  <!-- Game Over -->
  <div class="gameover" id="gameover">
    Game Over<br/>du musst zum Arbeitsamt.
  </div>

  <script>
    const point = { x: 53, y: 69 };
    const g = {
      el: document.getElementById('g1'),
      fillEl: document.querySelector('#g1 .fill'),
      pct: 100,
      speed: 4.2,
      jitter: 0,
      warnedThisCycle: false
    };
    let strikes = 0;
    let ended = false;
    let money = 0;
    const moneyEl = document.getElementById('money');

    const popup     = document.getElementById('popup');
    const popupText = document.getElementById('popupText');
    const popupBtn  = document.getElementById('popupBtn');
    const gameover  = document.getElementById('gameover');

    function showPopup(text){ popupText.textContent = text; popup.style.display = 'flex'; }
    function hidePopup(){ popup.style.display = 'none'; }
    popupBtn.addEventListener('click', ()=>{
      if (strikes >= 3){
        hidePopup();
        gameover.style.display = 'flex';
        ended = true;
      } else hidePopup();
    });

    function updateMoney(){
      moneyEl.textContent = money.toFixed(2).replace('.', ',') + ' €';
    }

    function spawnFx(text, className, x, y){
      const s = document.createElement('div');
      s.className = 'fx ' + className;
      s.textContent = text;
      s.style.left = x + 'px';
      s.style.top  = y + 'px';
      document.body.appendChild(s);
      setTimeout(()=> s.remove(), 950);
    }

    function moneyFxAtGlass(){
      const rect = g.el.getBoundingClientRect();
      spawnFx('+0,20 €', 'moneyFx', rect.left + rect.width/2, rect.top + rect.height*0.2);
    }

    function emojiFxAtGlass(emoji){
      const rect = g.el.getBoundingClientRect();
      spawnFx(emoji, 'emojiFx', rect.left + rect.width/2, rect.top - 10);
    }

    const fillUp = ()=>{
      if (ended) return;
      const prevPct = g.pct; // merken, wie voll es vorher war
      g.pct = 100;
      g.warnedThisCycle = false;
      money += 0.20;
      updateMoney();
      moneyFxAtGlass();

      // Emoji je nach vorherigem Füllstand
      if (prevPct <= 33) emojiFxAtGlass('😀');
      else if (prevPct <= 66) emojiFxAtGlass('😐');
      else emojiFxAtGlass('😠');

      render();
    };
    g.el.addEventListener('click', fillUp);
    g.el.addEventListener('touchend', fillUp, {passive:true});

    let last = performance.now();
    function loop(now){
      if (ended) return;
      const dt = Math.min(1000, now - last) / 1000; last = now;

      g.pct = Math.max(0, g.pct - Math.max(0, g.speed + g.jitter) * dt);

      if (g.pct <= 0 && !g.warnedThisCycle){
        g.warnedThisCycle = true;
        strikes++;
        if (strikes === 1)      showPopup('Erste Abmahnung');
        else if (strikes === 2) showPopup('Zweite Abmahnung');
        else if (strikes >= 3)  showPopup('Kündigung');
      }
      render();
      requestAnimationFrame(loop);
    }

    function render(){
      g.fillEl.style.height = g.pct + '%';
      g.el.classList.toggle('low',   g.pct <= 35 && g.pct > 0);
      g.el.classList.toggle('empty', g.pct <=  0);
    }

    function reshuffleJitter(){
      if (ended) return;
      g.jitter = (Math.random()*0.4 - 0.2) * g.speed;
      setTimeout(reshuffleJitter, 7000 + Math.random()*5000);
    }
    reshuffleJitter();

    const stage = document.getElementById('stage');
    const bg    = document.getElementById('bg');
    function positionGlass(){
      const sw = stage.clientWidth, sh = stage.clientHeight;
      const iw = bg.naturalWidth || 1024, ih = bg.naturalHeight || 1024;
      const scale = Math.max(sw/iw, sh/ih);
      const dw = iw*scale, dh = ih*scale;
      const offX = (sw - dw)/2, offY = (sh - dh)/2;
      const w = g.el.offsetWidth, h = g.el.offsetHeight;
      const x = offX + (point.x/100)*dw;
      const y = offY + (point.y/100)*dh;
      g.el.style.left = (x - w/2) + 'px';
      g.el.style.top  = (y - h*0.65) + 'px';
    }
    if (bg.complete) positionGlass(); else bg.addEventListener('load', positionGlass);
    addEventListener('resize', positionGlass, {passive:true});
    addEventListener('orientationchange', positionGlass, {passive:true});

    updateMoney();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>Köbes Panik – Version 0</title>
<style>
  html,body {
    height:100%; margin:0; background:#000; overflow:hidden;
    -webkit-tap-highlight-color:transparent;
  }
  .stage {
    position:fixed; inset:0;
    padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0);
  }
  #bg {
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:cover; object-position:center; user-select:none; pointer-events:none;
  }
  .money {
    position:absolute; top:12px; left:12px; z-index:4;
    background:rgba(0,0,0,.45); color:#ffd700;
    border:1px solid rgba(255,215,0,0.4); border-radius:10px;
    padding:8px 14px; font:600 16px system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    backdrop-filter: blur(2px);
  }
  .fx {
    position:absolute; z-index:5; font:700 18px system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    text-shadow:0 1px 2px rgba(0,0,0,.5); pointer-events:none; opacity:0;
    transform: translate(-50%,0); animation: rise 900ms ease-out forwards;
    white-space:nowrap;
  }
  .fx.money { color:#ffd700; font-size:16px; }
  .fx.tip { color:#56e39f; font-size:16px; }
  .fx.emoji { font-size:26px; }
  @keyframes rise {
    0%{opacity:0;transform:translate(-50%,10px)}
    12%{opacity:1;transform:translate(-50%,0)}
    70%{opacity:1;transform:translate(-50%,-40px)}
    100%{opacity:0;transform:translate(-50%,-60px)}
  }
  .glass {
    position:absolute; width:46px; height:70px;
    border:2px solid #d4aa00; border-radius:6px;
    background:rgba(255,255,255,.04); overflow:hidden;
    box-shadow:0 0 6px rgba(0,0,0,.55); cursor:pointer;
  }
  .glass.low { border-color:#ffb300; }
  .glass.empty { border-color:#ef5350; }
  .fill {
    position:absolute; left:0; bottom:0; width:100%; height:100%;
    background:linear-gradient(180deg,#f7e17c,#e1b12c);
    transition:height .2s ease;
  }
  .popup {
    position:fixed; inset:0; display:none;
    align-items:center; justify-content:center;
    background:rgba(0,0,0,.5); z-index:7;
  }
  .popup-content {
    background:#1b1f2a; color:#fff; padding:20px; border-radius:10px;
    text-align:center; max-width:80%;
  }
  .popup-content button {
    margin-top:12px; padding:8px 14px; border:none; border-radius:6px;
    background:#f6c356; color:#141821; font-weight:bold; cursor:pointer;
  }
  .gameover {
    position:fixed; inset:0; display:none;
    align-items:center; justify-content:center;
    background:#000; color:#fff; font:700 20px system-ui;
  }
</style>
</head>
<body>
<div class="stage" id="stage">
  <img id="bg" src="bg.png" alt="Hintergrund">
  <div class="money" id="money">0,00 €</div>
  <div class="glass" id="glass"><div class="fill"></div></div>
</div>

<audio id="bgm" src="Tavern.mp3" loop></audio>
<audio id="fillSound" src="fill.mp3"></audio>

<div class="popup" id="popup">
  <div class="popup-content">
    <div id="popupText">Abmahnung</div>
    <button id="popupBtn">OK</button>
  </div>
</div>

<div class="gameover" id="gameover">Game Over<br>Du musst zum Arbeitsamt.</div>

<script>
const glassEl = document.getElementById('glass');
const fillEl = glassEl.querySelector('.fill');
const moneyEl = document.getElementById('money');
const popup = document.getElementById('popup');
const popupText = document.getElementById('popupText');
const popupBtn = document.getElementById('popupBtn');
const gameover = document.getElementById('gameover');
const bgm = document.getElementById('bgm');
const fillSound = document.getElementById('fillSound');

let money = 0;
let strikes = 0;
let ended = false;

let pct = 100;
let speed = 5; // Füllverlust pro Sekunde

bgm.volume = 0.5;
bgm.play().catch(()=>{});
document.addEventListener('pointerdown', () => { if (bgm.paused) bgm.play().catch(()=>{}); }, {once:true});

function euro(v){ return v.toFixed(2).replace('.', ',') + ' €'; }
function updateMoney(){ moneyEl.textContent = euro(money); }

function spawnFx(text, cls, x, y){
  const s = document.createElement('div');
  s.className = 'fx ' + cls;
  s.textContent = text;
  s.style.left = x+'px';
  s.style.top = y+'px';
  document.body.appendChild(s);
  setTimeout(()=>s.remove(), 950);
}

function showPopup(text){
  popupText.textContent = text;
  popup.style.display = 'flex';
}
popupBtn.onclick = () => {
  popup.style.display = 'none';
  if (strikes >= 3) {
    gameover.style.display = 'flex';
    ended = true;
  }
};

function handleFill(){
  if (ended) return;
  fillSound.currentTime = 0;
  fillSound.play().catch(()=>{});
  
  const prev = pct;
  pct = 100;

  let tip = 0, emoji = '';
  if (prev <= 33) { tip = 0.25*0.1; emoji = '😀'; }
  else if (prev <= 66) { emoji = '😐'; }
  else { emoji = '😠'; }

  money += 0.25 + tip;
  updateMoney();

  const r = glassEl.getBoundingClientRect();
  spawnFx('+'+euro(0.25), 'money', r.left+r.width/2 - 40, r.top);
  if (tip>0) spawnFx('TIP +'+euro(tip), 'tip', r.left+r.width/2 + 40, r.top);
  spawnFx(emoji, 'emoji', r.left+r.width/2, r.top - 20);
}

glassEl.addEventListener('click', handleFill);

function render(){
  fillEl.style.height = pct + '%';
  glassEl.classList.toggle('low', pct<=35 && pct>0);
  glassEl.classList.toggle('empty', pct<=0);
}

let last = performance.now();
function loop(now){
  if (ended) return;
  const dt = (now - last)/1000;
  last = now;
  pct = Math.max(0, pct - speed*dt);
  if (pct<=0 && !glassEl.classList.contains('empty')){
    strikes++;
    if (strikes === 1) showPopup('Erste Abmahnung');
    else if (strikes === 2) showPopup('Zweite Abmahnung');
    else if (strikes >= 3) showPopup('Kündigung');
  }
  render();
  requestAnimationFrame(loop);
}

updateMoney();
requestAnimationFrame(loop);
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>K√∂bes Panik</title>
<style>
  html,body{height:100%;margin:0;background:#000;overflow:hidden;-webkit-tap-highlight-color:transparent}
  .stage{position:fixed;inset:0}
  #bg{position:absolute;inset:0;width:100vw;height:100vh;object-fit:cover;object-position:center;user-select:none;pointer-events:none}

  /* Geldanzeige */
  .money{
    position:absolute; top:12px; left:12px; z-index:4;
    background:rgba(0,0,0,.45); color:#ffd700;
    border:1px solid rgba(255,215,0,0.4); border-radius:10px;
    padding:8px 14px; font:600 16px/1.2 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    backdrop-filter: blur(2px); box-shadow:0 2px 6px rgba(0,0,0,0.4);
  }

  /* Symbol-Leiste oben rechts */
  .hud-right{
    position:absolute; top:12px; right:12px; z-index:4;
    display:flex; gap:8px;
  }
  .hudbtn{
    width:42px; height:42px; display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.45); color:#ffd700;
    border:1px solid rgba(255,215,0,.4); border-radius:10px;
    font:22px/1 "Apple Color Emoji","Segoe UI Emoji",system-ui,sans-serif;
    cursor:pointer; user-select:none; box-shadow:0 2px 6px rgba(0,0,0,.4);
  }
  .hudbtn.active{ background:rgba(0,128,0,.4); border-color:rgba(120,255,120,.5); }

  /* Effekte (Geld, TIP, Emoji, Malus) */
  .fx{
    position:absolute; z-index:5; font:700 18px/1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    text-shadow:0 1px 2px rgba(0,0,0,.5); pointer-events:none; opacity:0;
    transform: translate(-50%,0) translateZ(0); animation: rise 900ms ease-out forwards;
    white-space:nowrap;
  }
  .fx.money{ color:#ffd700; font-size:16px; }
  .fx.tip  { color:#56e39f; font-size:16px; }
  .fx.emoji{ font-size:26px; }
  .fx.malus{ color:#ef5350; font-size:16px; }
  @keyframes rise{
    0%{opacity:0;transform:translate(-50%,10px)}
    12%{opacity:1;transform:translate(-50%,0)}
    70%{opacity:1;transform:translate(-50%,-40px)}
    100%{opacity:0;transform:translate(-50%,-60px)}
  }

  /* Gl√§ser */
  .glass{
    position:absolute;width:46px;height:70px;border:2px solid #d4aa00;border-radius:6px;
    background:rgba(255,255,255,.04);overflow:hidden;box-shadow:0 0 6px rgba(0,0,0,.55);
    z-index:3;touch-action:manipulation;cursor:pointer;
  }
  .fill{position:absolute;left:0;bottom:0;width:100%;height:100%;
    background:linear-gradient(180deg,#f7e17c,#e1b12c);transition:height .22s ease}
</style>
</head>
<body>
  <div class="stage" id="stage">
    <img id="bg" src="bg.png" alt="">

    <div class="money" id="money">0,00 ‚Ç¨</div>

    <!-- HUD oben rechts -->
    <div class="hud-right">
      <div class="hudbtn" id="eatBtn" title="Essen">üçΩÔ∏è</div>
      <div class="hudbtn" id="drinkBtn" title="Bier trinken">üç∫</div>
      <div class="hudbtn" id="smokeBtn" title="Rauchen">üö¨</div>
      <div class="hudbtn" id="assistantBtn" title="Assistent">ü§ù</div>
      <div class="hudbtn" id="soundBtn" title="Sound">üîä</div>
    </div>

    <!-- Start-Glas -->
    <div class="glass" id="g0"><div class="fill"></div></div>
  </div>

  <!-- Sounds -->
  <audio id="bgm" src="Tavern.mp3" loop></audio>
  <audio id="fillSound" src="fill.mp3"></audio>

<script>
const BASE_EURO = 0.25;
const TIP_RATE = 0.10;
let money = 0;
let ended = false;

const moneyEl = document.getElementById('money');
function euro(v){ return v.toFixed(2).replace('.', ',') + ' ‚Ç¨'; }
function updateMoney(){ moneyEl.textContent = euro(money); }

const bgm = document.getElementById('bgm');
const fillSound = document.getElementById('fillSound');
bgm.volume = 0.5;
fillSound.volume = 0.7;
bgm.play().catch(()=>{});
document.addEventListener('pointerdown',()=>{ if(bgm.paused) bgm.play().catch(()=>{}); },{once:true});

document.getElementById('soundBtn').onclick = ()=>{
  bgm.muted = !bgm.muted;
  document.getElementById('soundBtn').textContent = bgm.muted ? 'üîá' : 'üîä';
};

let assistantOn = false;
document.getElementById('assistantBtn').onclick = ()=>{
  assistantOn = !assistantOn;
  document.getElementById('assistantBtn').classList.toggle('active',assistantOn);
};

function spawnFx(text, className, x, y){
  const s = document.createElement('div');
  s.className = 'fx ' + className;
  s.textContent = text;
  s.style.left = x + 'px';
  s.style.top  = y + 'px';
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),900);
}

function triFx(glassEl, {moneyTxt, tipTxt, emojiTxt, malusTxt}){
  const r = glassEl.getBoundingClientRect();
  const cx = r.left + r.width/2;
  const cy = r.top  + r.height*0.15;
  const dx = 62, dyTop = 34, dyRow = 14;
  if (moneyTxt) spawnFx(moneyTxt, 'money', cx - dx, cy - dyRow);
  if (tipTxt)   spawnFx(tipTxt,   'tip',   cx + dx, cy - dyRow);
  if (emojiTxt) spawnFx(emojiTxt, 'emoji', cx,      cy - dyTop);
  if (malusTxt) spawnFx(malusTxt, 'malus', cx,      cy);
}

const glass = {
  el: document.getElementById('g0'),
  fillEl: document.querySelector('#g0 .fill'),
  pct: 100,
  speed: 5
};

function renderGlass(){
  glass.fillEl.style.height = glass.pct + '%';
}

glass.el.onclick = ()=>{
  if (ended) return;
  fillSound.currentTime = 0;
  fillSound.play();

  let prev = glass.pct;
  glass.pct = 100;
  let addBase = BASE_EURO, tipAdd = 0, emoji = '', malus = '';

  if (prev <= 33){
    emoji = 'üòÄ';
    tipAdd = BASE_EURO * TIP_RATE;
  } else if (prev <= 66){
    emoji = 'üòê';
  } else {
    emoji = 'üò†';
  }

  const share = assistantOn ? 0.5 : 1;
  money += (addBase + tipAdd) * share;
  updateMoney();

  const moneyTxt = '+' + euro(addBase * share).replace(' ‚Ç¨',' ‚Ç¨');
  const tipTxt   = tipAdd > 0 ? 'TIP +' + euro(tipAdd * share).replace(' ‚Ç¨',' ‚Ç¨') : null;
  triFx(glass.el, {moneyTxt, tipTxt, emojiTxt: emoji, malusTxt: malus});
  renderGlass();
};

function loop(){
  if (!ended){
    glass.pct = Math.max(0, glass.pct - glass.speed * 0.016);
    renderGlass();
    requestAnimationFrame(loop);
  }
}
updateMoney();
renderGlass();
loop();
</script>
</body>
</html>